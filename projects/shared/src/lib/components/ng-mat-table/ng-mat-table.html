<table mat-table [dataSource]="dataSource" matSort class="mat-elevation-z8">
  <!-- ✅ Checkbox Column -->
  @if (headerCheckbox || rowCheckbox) {
  <ng-container matColumnDef="select">
    <!-- Header Checkbox -->

    <th mat-header-cell *matHeaderCellDef style="width: 50px">
      @if (headerCheckbox) {
      <mat-checkbox
        (change)="toggleAllRows()"
        [checked]="isAllSelected()"
        [indeterminate]="selection.hasValue() && !isAllSelected()"
        [aria-label]="checkboxLabel()"
      >
      </mat-checkbox>
      }
    </th>

    <!-- Row Checkbox -->

    <td mat-cell *matCellDef="let row" style="width: 50px">
      @if (rowCheckbox) {
      <mat-checkbox
        (click)="$event.stopPropagation()"
        (change)="toggleRow(row)"
        [checked]="selection.isSelected(row)"
        [aria-label]="checkboxLabel(row)"
      >
      </mat-checkbox>
      }
    </td>
  </ng-container>
  }
  <!-- ✅ Dynamic Columns -->
  @for (col of columns; track col.key) {
  <ng-container [matColumnDef]="col.key">
    <!-- Header -->
    <th mat-header-cell *matHeaderCellDef [style.width]="col.width">
      @if (col.headerTemplate !== undefined) {
      <ng-container
        *ngTemplateOutlet="col.headerTemplate; context: { column: col }"
      >
      </ng-container>
      } @else {
      {{ col.label }}
      }
    </th>

    <!-- Row -->
    <td mat-cell *matCellDef="let element" (click)="onRowClick(element)">
      @if (col.template !== undefined) {
      <ng-container
        *ngTemplateOutlet="
          col.template;
          context: { $implicit: element, row: element }
        "
      >
      </ng-container>
      } @else {
      <span [ngClass]="col.className" [style.color]="col.color || 'inherit'">
        @if (col.type === 'link') {
        <a [href]="element[col.key]">{{ element[col.key] }}</a>
        } @else {
        {{ element[col.key] }}
        }
      </span>
      }
    </td>
  </ng-container>
  }

  <!-- ✅ Render header & rows -->
  <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
  <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
</table>

<!-- ✅ Paginator -->
@if (isPaginator) {
<mat-paginator
  [pageSize]="options.pageSize || 10"
  [pageSizeOptions]="options.pageSizeOptions || [5, 10, 20]"
>
</mat-paginator>
}
