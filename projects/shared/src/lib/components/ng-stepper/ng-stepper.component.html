<mat-stepper 
  [orientation]="orientation()"
  [linear]="linear()"
  [selectedIndex]="selectedIndex()"
  [labelPosition]="labelPosition()"
  (selectionChange)="onSelectionChange($event)">
  
  @for (step of steps(); track $index; let i = $index) {
    <mat-step 
      [label]="step.label"
      [completed]="step.completed"
      [editable]="step.editable"
      [optional]="step.optional"
      [hasError]="step.hasError"
      [stepControl]="stepControls() && stepControls()[i]">
      
      @if (step.content) {
        <ng-container *ngTemplateOutlet="step.content; context: { $implicit: step.data, step: step, index: i }" />
      } @else {
        <div class="step-content-slot">
          <!-- Content will be projected here or defined dynamically -->
          <ng-content />
        </div>
      }
      
      @if (showNavigation()) {
        <div class="step-navigation">
          @if (i > 0) {
            <button mat-button (click)="goBack()">
              <mat-icon>chevron_left</mat-icon>
              {{ backText() }}
            </button>
          }
          
          <div class="spacer"></div>
          
          @if (i < steps().length - 1) {
            <button mat-flat-button color="primary" (click)="goForward()">
              {{ nextText() }}
              <mat-icon>chevron_right</mat-icon>
            </button>
          } @else {
            <button mat-flat-button color="primary" (click)="complete()">
              {{ completeText() }}
            </button>
          }
        </div>
      }
    </mat-step>
  }
</mat-stepper>