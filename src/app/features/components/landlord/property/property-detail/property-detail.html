<div class="property-detail-container">
  <!-- Header Section -->
  <div class="header-section">
    <div class="header-content">
      <ng-icon
        name="arrow_back"
        class="arrow_back"
        matTooltip="Go back to property list"
        (click)="goBack()"
      />

      <div class="header-info">
        <h1>{{ property.title || "Property Details" }}</h1>
        <div class="header-meta">
          <span class="property-id">Property Details</span>
        </div>
      </div>
      <div class="header-actions">
        <ng-icon
          name="edit"
          class="icon-orange icon-clickable"
          matTooltip="Edit Property"
          (click)="editProperty()"
        />
        <ng-icon
          name="more"
          class="icon-orange icon-clickable"
          matTooltip="More Options"
          [ngMenuTriggerFor]="moreMenu"
        />
      </div>
    </div>
  </div>

  <div class="content-grid">
    <!-- Property Images Section -->
    <ng-card title="Property Images" icon="photo_library" class="images-card">
      @if (initPage$) {
        <div class="image-gallery">
          <div class="main-image">
            <img
              alt="Property Image"
              [src]="selectedImage.url || defaultImage"
            />
            <div class="image-overlay">
              <ng-button
                buttonType="button"
                type="fab"
                icon="photo_library"
                class="gallery-btn"
                tooltip="View Gallery"
                (buttonClick)="openGallery()"
              />
            </div>
          </div>
          @if (propertiesImages.length > 1) {
            <div class="thumbnail-strip">
              @for (image of propertiesImages; track image) {
                <div
                  class="thumbnail"
                  [class.active]="image === selectedImage"
                  (click)="selectImage(image)"
                >
                  <img alt="Property thumbnail" [src]="image.url" />
                </div>
              }
            </div>
          }
        </div>
      }
    </ng-card>

    <!-- Property Overview -->
    <ng-card title="Property Overview" icon="visibility" class="overview-card">
      <div class="overview-grid">
        <div class="overview-item">
          <ng-icon name="home" class="item-icon" />
          <div class="item-content">
            <span class="label">Type</span>
            <span class="value">{{
              getPropertyType(property.propertyType!)
            }}</span>
          </div>
        </div>
        <div class="overview-item">
          <ng-icon name="bed" class="item-icon" />
          <div class="item-content">
            <span class="label">Configuration</span>
            <span class="value">{{ property.bhkConfiguration }}</span>
          </div>
        </div>
        <div class="overview-item">
          <ng-icon name="square_foot" class="item-icon" />
          <div class="item-content">
            <span class="label">Carpet Area</span>
            <span class="value">{{ property.carpetAreaSqFt }} sq ft</span>
          </div>
        </div>
        <div class="overview-item">
          <ng-icon name="layers" class="item-icon" />
          <div class="item-content">
            <span class="label">Floor</span>
            <span class="value"
              >{{ property.floorNumber }} of {{ property.totalFloors }}</span
            >
          </div>
        </div>
        <div class="overview-item">
          <ng-icon name="chair" class="item-icon" />
          <div class="item-content">
            <span class="label">Furnishing</span>
            <span class="value">{{
              getFurnishingType(property.furnishingType!)
            }}</span>
          </div>
        </div>
        <div class="overview-item">
          <ng-icon name="schedule" class="item-icon" />
          <div class="item-content">
            <span class="label">Available From</span>
            <span class="value">{{ formatDate(property.availableFrom) }}</span>
          </div>
        </div>
      </div>
    </ng-card>

    <!-- Rent Details -->
    <ng-card title="Rent Details" icon="payments" class="rent-card">
      <div class="rent-info">
        <div class="rent-main">
          <div class="rent-amount">
            <ng-icon name="currency_rupee" class="currency-icon" />
            <span class="amount">{{
              formatCurrency(property.monthlyRent)
            }}</span>
            <span class="period">/month</span>
          </div>
          @if (property.isNegotiable) {
            <div class="negotiable-badge">
              <ng-icon name="handshake" class="negotiable-icon" />
              <span>Negotiable</span>
            </div>
          }
        </div>
        <div class="rent-details">
          <div class="detail-item">
            <ng-icon name="security" class="detail-icon" />
            <div class="detail-content">
              <span class="label">Security Deposit</span>
              <span class="value"
                >â‚¹{{ formatCurrency(property.securityDeposit) }}</span
              >
            </div>
          </div>
          <div class="detail-item">
            <ng-icon name="schedule" class="detail-icon" />
            <div class="detail-content">
              <span class="label">Lease Type</span>
              <span class="value">{{ getLeaseType(property.leaseType!) }}</span>
            </div>
          </div>
        </div>
      </div>
    </ng-card>

    <!-- Location Details -->
    <ng-card title="Location" icon="place" class="location-card">
      <div class="location-info">
        <div class="address-section">
          <ng-icon name="home" class="address-icon" />
          <div class="address-content">
            <p class="address-line">{{ property.addressLine1 }}</p>
            @if (property.addressLine2) {
              <p class="address-line">{{ property.addressLine2 }}</p>
            }
            <p class="address-line">
              {{ property.locality }}, {{ property.city }}
            </p>
            <p class="address-line">
              {{ property.state }} - {{ property.pinCode }}
            </p>
          </div>
        </div>
        @if (property.landmark) {
          <div class="landmark-section">
            <ng-icon name="map" class="landmark-icon" />
            <span class="landmark-text">Near {{ property.landmark }}</span>
          </div>
        }
        <ng-button
          buttonType="button"
          type="outlined"
          label="View on Map"
          icon="location_on"
          class="map-button"
          (buttonClick)="showOnMap()"
        />
      </div>
    </ng-card>

    <!-- Property Details -->
    <ng-card title="Property Details" icon="info" class="details-card">
      <div class="details-grid">
        <div class="detail-group">
          <div class="group-header">
            <ng-icon name="bathtub" class="group-icon" />
            <h4>Room Details</h4>
          </div>
          <div class="detail-item">
            <ng-icon name="bathtub" class="detail-icon" />
            <div class="detail-content">
              <span class="label">Bathrooms</span>
              <span class="value">{{ property.numberOfBathrooms }}</span>
            </div>
          </div>
          <div class="detail-item">
            <ng-icon name="balcony" class="detail-icon" />
            <div class="detail-content">
              <span class="label">Balconies</span>
              <span class="value">{{ property.numberOfBalconies || 0 }}</span>
            </div>
          </div>
        </div>

        <div class="detail-group">
          <div class="group-header">
            <ng-icon name="square_foot" class="group-icon" />
            <h4>Area Details</h4>
          </div>
          <div class="detail-item">
            <ng-icon name="square_foot" class="detail-icon" />
            <div class="detail-content">
              <span class="label">Carpet Area</span>
              <span class="value">{{ property.carpetAreaSqFt }} sq ft</span>
            </div>
          </div>
          <div class="detail-item">
            <ng-icon name="architecture" class="detail-icon" />
            <div class="detail-content">
              <span class="label">Built-up Area</span>
              <span class="value">{{ property.builtUpAreaSqFt }} sq ft</span>
            </div>
          </div>
        </div>
      </div>
    </ng-card>

    <!-- Amenities -->
    <ng-card
      title="Amenities & Features"
      icon="apartment"
      class="amenities-card"
    >
      <div class="amenities-grid">
        <div class="amenity-item" [class.available]="property.hasLift">
          <ng-icon name="elevator" class="amenity-icon" />
          <span class="amenity-label">Lift</span>
          <ng-icon
            class="status-icon"
            [class.available]="property.hasLift"
            [name]="property.hasLift ? 'check_circle' : 'cancel'"
          />
        </div>
        <div class="amenity-item" [class.available]="property.hasParking">
          <ng-icon name="local_parking" class="amenity-icon" />
          <span class="amenity-label">Parking</span>
          <ng-icon
            class="status-icon"
            [class.available]="property.hasParking"
            [name]="property.hasParking ? 'check_circle' : 'cancel'"
          />
        </div>
        <div class="amenity-item" [class.available]="property.hasPowerBackup">
          <ng-icon name="battery_charging_full" class="amenity-icon" />
          <span class="amenity-label">Power Backup</span>
          <ng-icon
            class="status-icon"
            [class.available]="property.hasPowerBackup"
            [name]="property.hasPowerBackup ? 'check_circle' : 'cancel'"
          />
        </div>
        <div class="amenity-item" [class.available]="property.hasWaterSupply">
          <ng-icon name="water_drop" class="amenity-icon" />
          <span class="amenity-label">24/7 Water</span>
          <ng-icon
            class="status-icon"
            [class.available]="property.hasWaterSupply"
            [name]="property.hasWaterSupply ? 'check_circle' : 'cancel'"
          />
        </div>
        <div class="amenity-item" [class.available]="property.hasGasPipeline">
          <ng-icon name="local_fire_department" class="amenity-icon" />
          <span class="amenity-label">Gas Pipeline</span>
          <ng-icon
            class="status-icon"
            [class.available]="property.hasGasPipeline"
            [name]="property.hasGasPipeline ? 'check_circle' : 'cancel'"
          />
        </div>
        <div class="amenity-item" [class.available]="property.hasSecurity">
          <ng-icon name="security" class="amenity-icon" />
          <span class="amenity-label">Security</span>
          <ng-icon
            class="status-icon"
            [class.available]="property.hasSecurity"
            [name]="property.hasSecurity ? 'check_circle' : 'cancel'"
          />
        </div>
        <div class="amenity-item" [class.available]="property.hasInternet">
          <ng-icon name="wifi" class="amenity-icon" />
          <span class="amenity-label">Internet Ready</span>
          <ng-icon
            class="status-icon"
            [class.available]="property.hasInternet"
            [name]="property.hasInternet ? 'check_circle' : 'cancel'"
          />
        </div>
      </div>
    </ng-card>

    <!-- Description -->
    @if (property.description) {
      <ng-card title="Description" icon="description" class="description-card">
        <div class="description-content">
          <ng-icon name="format_quote" class="quote-icon" />
          <p class="description-text">{{ property.description }}</p>
        </div>
      </ng-card>
    }

    <!-- Property Actions -->
    <ng-card title="Property Actions" icon="settings" class="actions-card">
      <div class="actions-grid">
        <ng-button
          buttonType="button"
          type="filled"
          label="Edit Property"
          icon="edit"
          class="action-btn primary"
          (buttonClick)="editProperty()"
        />
        <ng-button
          buttonType="button"
          type="outlined"
          label="Share Property"
          icon="share"
          class="action-btn secondary"
          (buttonClick)="shareProperty()"
        />
        <ng-button
          buttonType="button"
          type="outlined"
          label="Download Details"
          icon="download"
          class="action-btn secondary"
          (buttonClick)="downloadDetails()"
        />
      </div>
    </ng-card>
  </div>
</div>

<!-- More Options Menu -->
<ng-menu #moreMenu="ng-menu">
  <button type="button" ng-menu-item (click)="markAsFavorite()">
    <ng-icon name="favorite_border" />
    <span>Add to Favorites</span>
  </button>
  <button type="button" ng-menu-item (click)="reportProperty()">
    <ng-icon name="report" />
    <span>Report Property</span>
  </button>
  <button type="button" ng-menu-item (click)="downloadDetails()">
    <ng-icon name="download" />
    <span>Download Details</span>
  </button>
  <ng-divider />
  <button
    type="button"
    ng-menu-item
    class="danger-item"
    (click)="deleteProperty()"
  >
    <ng-icon name="delete" />
    <span>Delete Property</span>
  </button>
</ng-menu>
