<!-- eslint-disable @angular-eslint/template/no-inline-styles -->
<div class="tenant-dashboard">
  <!-- Page Header -->
  <div class="dashboard-header">
    <div class="header-content">
      <h1>Tenant Management</h1>
      <p>Manage your tenants, agreements, and onboarding process</p>
    </div>
    @if (currentView === "table") {
      <div class="header-actions">
        <button
          type="button"
          class="add-tenant-btn"
          matTooltip="Add New Tenant"
          (click)="onAddTenant()"
        >
          <ng-icon name="person_add" style="color: white !important" />
          Add New Tenant
        </button>
      </div>
    }
  </div>

  <!-- Table View -->
  @if (currentView === "table") {
    <div class="table-view">
      <!-- Statistics Cards -->
      <div class="stats-cards">
        <div class="stat-card">
          <ng-icon name="people" class="stat-icon" />
          <div class="stat-content">
            <span class="stat-number">{{ tenants.length }}</span>
            <span class="stat-label">Total Tenants</span>
          </div>
        </div>
        <div class="stat-card">
          <ng-icon name="check_circle" class="stat-icon active" />
          <div class="stat-content">
            <span class="stat-number">{{ getActiveTenants() }}</span>
            <span class="stat-label">Active Tenants</span>
          </div>
        </div>
        <div class="stat-card">
          <ng-icon name="pending" class="stat-icon pending" />
          <div class="stat-content">
            <span class="stat-number">{{ getPendingOnboarding() }}</span>
            <span class="stat-label">Pending Onboarding</span>
          </div>
        </div>
        <div class="stat-card">
          <ng-icon name="attach_money" class="stat-icon revenue" />
          <div class="stat-content">
            <span class="stat-number"
              >â‚¹{{ getTotalRentAmount() | number: "1.0-0" }}</span
            >
            <span class="stat-label">Monthly Rent</span>
          </div>
        </div>
      </div>
      <!-- Tenant Table with NgMatTable -->
      <div class="table-section">
        <ng-mat-table
          [columns]="tableColumns"
          [data]="primaryTenants"
          [options]="tableOptions"
          [expandableRows]="true"
          [expandedRowTemplate]="expandedRowTemplate"
          [expandKey]="'id'"
          [isPaginator]="true"
          (rowClick)="onRowClick($event)"
          (rowExpand)="onRowExpand($event)"
        />

        <!-- Template for expanded row content -->
        <ng-template #expandedRowTemplate let-tenant>
          <div
            class="expanded-content"
            style="
              background: #ffeb3b;
              padding: 20px;
              margin: 10px;
              border: 2px solid #f57c00;
            "
          >
            <h4 style="color: #e65100">
              <ng-icon name="people" style="color: #2196f3" />
              ðŸ”„ EXPANDED ROW - Tenant Group Details ({{ tenant.tenantGroup }})
            </h4>
            <div
              style="
                background: #4caf50;
                color: white;
                padding: 10px;
                margin: 10px 0;
              "
            >
              âœ… EXPANSION IS WORKING! Tenant ID: {{ tenant.id }}
            </div>

            <div class="tenant-grid">
              @for (
                member of getGroupMembers(tenant.tenantGroup);
                track member.id
              ) {
                <div class="tenant-card">
                  <div class="tenant-header">
                    <div class="tenant-avatar">
                      <ng-icon
                        [name]="member.isPrimary ? 'star' : 'person'"
                        [style.color]="member.isPrimary ? '#ffc107' : '#666'"
                      />
                    </div>
                    <div class="tenant-name">
                      <span>{{ member.name }}</span>
                      @if (member.isPrimary) {
                        <span class="primary-badge">Primary</span>
                      }
                    </div>
                  </div>

                  <div class="tenant-details">
                    <div class="detail-row">
                      <ng-icon
                        style="font-size: 14px"
                        [name]="getStatusIcon(member)"
                      />
                      <span [class]="getStatusClass(member)">{{
                        getStatusText(member)
                      }}</span>
                    </div>

                    <div class="detail-row">
                      <span class="label">Email:</span>
                      <span>{{ member.email }}</span>
                    </div>

                    <div class="detail-row">
                      <span class="label">Phone:</span>
                      <span>{{ member.phoneNumber }}</span>
                    </div>

                    <div class="detail-row">
                      <span class="label">Rent:</span>
                      <span>â‚¹{{ member.rentAmount | number }}</span>
                    </div>

                    <!-- Quick Actions -->
                    <div class="tenant-actions">
                      <ng-button
                        buttonType="button"
                        type="icon"
                        icon="description"
                        tooltip="Create Agreement"
                        (buttonClick)="onCreateAgreement(member)"
                      />
                      <ng-button
                        buttonType="button"
                        type="icon"
                        icon="edit"
                        tooltip="Edit"
                        (buttonClick)="onEditTenant(member)"
                      />
                      <ng-button
                        buttonType="button"
                        type="icon"
                        icon="delete"
                        tooltip="Delete"
                        (buttonClick)="onDeleteTenant(member)"
                      />
                    </div>
                  </div>
                </div>
              }
            </div>
          </div>
        </ng-template>
      </div>
    </div>
  }

  <!-- Add Tenant Form -->
  @if (currentView === "add") {
    <div class="form-view">
      <app-tenant-add
        [propertyOptions]="propertyOptions"
        (tenantAdded)="onTenantAdded()"
        (cancel)="onTenantAddCancelled()"
      />
    </div>
  }
</div>
