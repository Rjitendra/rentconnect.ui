<div class="tenant-dashboard">
  <!-- Page Header -->
  <div class="dashboard-header">
    <div class="header-content">
      <h1>Tenant Management</h1>
      <p>Manage your tenants, agreements, and onboarding process</p>
    </div>
    <div class="header-actions" *ngIf="currentView === 'table'">
      <button
        type="button"
        class="add-tenant-btn"
        matTooltip="Add New Tenant"
        (click)="onAddTenant()">
        <ng-icon name="person_add" style="color: white !important;" />
        Add New Tenant
      </button>
    </div>
  </div>

  <!-- Table View -->
  <div *ngIf="currentView === 'table'" class="table-view">
    <!-- Statistics Cards -->
    <div class="stats-cards">
      <div class="stat-card">
        <ng-icon name="people" class="stat-icon" />
        <div class="stat-content">
          <span class="stat-number">{{ tenants.length }}</span>
          <span class="stat-label">Total Tenants</span>
        </div>
      </div>
      <div class="stat-card">
        <ng-icon name="check_circle" class="stat-icon active" />
        <div class="stat-content">
          <span class="stat-number">{{ getActiveTenants() }}</span>
          <span class="stat-label">Active Tenants</span>
        </div>
      </div>
      <div class="stat-card">
        <ng-icon name="pending" class="stat-icon pending" />
        <div class="stat-content">
          <span class="stat-number">{{ getPendingOnboarding() }}</span>
          <span class="stat-label">Pending Onboarding</span>
        </div>
      </div>
      <div class="stat-card">
        <ng-icon name="attach_money" class="stat-icon revenue" />
        <div class="stat-content">
          <span class="stat-number">â‚¹{{ getTotalRentAmount() | number:'1.0-0' }}</span>
          <span class="stat-label">Monthly Rent</span>
        </div>
      </div>
    </div>

    <!-- Tenant Table -->
    <div class="table-section">
      <div class="table-container">
        <table mat-table [dataSource]="primaryTenants" multiTemplateDataRows class="tenant-table mat-elevation-z8">
          
          <!-- Expand Column -->
          <ng-container matColumnDef="expand">
            <th mat-header-cell *matHeaderCellDef aria-label="row actions">&nbsp;</th>
            <td mat-cell *matCellDef="let tenant">
              <button
                mat-icon-button
                aria-label="expand row"
                (click)="toggleExpansion(tenant); $event.stopPropagation()"
                class="expand-toggle-button"
                [class.expand-toggle-button-expanded]="isExpanded(tenant)">
                <mat-icon>keyboard_arrow_down</mat-icon>
              </button>
            </td>
          </ng-container>

          <!-- ID Column -->
          <ng-container matColumnDef="id">
            <th mat-header-cell *matHeaderCellDef>ID</th>
            <td mat-cell *matCellDef="let tenant">{{ tenant.id }}</td>
          </ng-container>

          <!-- Primary Tenant Column -->
          <ng-container matColumnDef="name">
            <th mat-header-cell *matHeaderCellDef>Primary Tenant</th>
            <td mat-cell *matCellDef="let tenant">
              <div class="tenant-name-cell">
                <div class="tenant-avatar">
                  <mat-icon style="color: #ffc107;">star</mat-icon>
                </div>
                <div class="tenant-info">
                  <span class="name">{{ tenant.name }}</span>
                  <span class="email">{{ tenant.email }}</span>
                  <span class="group-info" *ngIf="getGroupMemberCount(tenant.tenantGroup) > 1">
                    + {{ getGroupMemberCount(tenant.tenantGroup) - 1 }} more tenant{{ getGroupMemberCount(tenant.tenantGroup) > 2 ? 's' : '' }}
                  </span>
                </div>
              </div>
            </td>
          </ng-container>

          <!-- Property Column -->
          <ng-container matColumnDef="property">
            <th mat-header-cell *matHeaderCellDef>Property</th>
            <td mat-cell *matCellDef="let tenant">
              <div class="property-cell">
                <mat-icon style="color: #4caf50;">home</mat-icon>
                <span>{{ getPropertyName(tenant.propertyId) }}</span>
              </div>
            </td>
          </ng-container>

          <!-- Phone Column -->
          <ng-container matColumnDef="phone">
            <th mat-header-cell *matHeaderCellDef>Phone</th>
            <td mat-cell *matCellDef="let tenant">{{ tenant.phoneNumber }}</td>
          </ng-container>

          <!-- Rent Amount Column -->
          <ng-container matColumnDef="rentAmount">
            <th mat-header-cell *matHeaderCellDef>Rent Amount</th>
            <td mat-cell *matCellDef="let tenant">{{ tenant.rentAmount }}</td>
          </ng-container>

          <!-- Tenants Count Column -->
          <ng-container matColumnDef="tenantCount">
            <th mat-header-cell *matHeaderCellDef>Tenants</th>
            <td mat-cell *matCellDef="let tenant">{{ getGroupMemberCount(tenant.tenantGroup) }}</td>
          </ng-container>

          <!-- Status Column -->
          <ng-container matColumnDef="status">
            <th mat-header-cell *matHeaderCellDef>Status</th>
            <td mat-cell *matCellDef="let tenant">
              <span class="status-chip" [ngClass]="getStatusClass(tenant)">
                <mat-icon style="font-size: 14px;">{{ getStatusIcon(tenant) }}</mat-icon>
                {{ getStatusText(tenant) }}
              </span>
            </td>
          </ng-container>

          <!-- Actions Column -->
          <ng-container matColumnDef="actions">
            <th mat-header-cell *matHeaderCellDef>Actions</th>
            <td mat-cell *matCellDef="let tenant">
              <div class="actions-cell">
                <mat-icon
                  matTooltip="View Details"
                  style="color: #2196f3; cursor: pointer;"
                  (click)="onViewTenant(tenant)">
                  visibility
                </mat-icon>
                
                <mat-icon
                  matTooltip="Edit Tenant"
                  style="color: #ff9800; cursor: pointer;"
                  (click)="onEditTenant(tenant)">
                  edit
                </mat-icon>
                
                <mat-icon
                  matTooltip="Create Agreement"
                  style="color: #9c27b0; cursor: pointer;"
                  (click)="onCreateAgreement(tenant)">
                  description
                </mat-icon>
                
                <mat-icon
                  matTooltip="Send Onboarding Email"
                  style="color: #4caf50; cursor: pointer;"
                  *ngIf="tenant.needsOnboarding"
                  (click)="onSendOnboardingEmail(tenant)">
                  email
                </mat-icon>
                
                <mat-icon
                  matTooltip="Delete Tenant"
                  style="color: #f44336; cursor: pointer;"
                  (click)="onDeleteTenant(tenant)">
                  delete
                </mat-icon>
              </div>
            </td>
          </ng-container>

          <!-- Expanded Detail Column -->
          <ng-container matColumnDef="expandedDetail">
            <td mat-cell *matCellDef="let tenant" [attr.colspan]="displayedColumnsWithExpand.length">
              <div class="tenant-detail-wrapper" [class.tenant-detail-wrapper-expanded]="isExpanded(tenant)">
                <div class="tenant-detail">
                  <div class="expanded-header">
                    <h3>
                      <mat-icon style="color: #2196f3;">people</mat-icon>
                      All Tenants in {{ getPropertyName(tenant.propertyId) }}
                      <span class="tenant-count">({{ getGroupMemberCount(tenant.tenantGroup) }} tenants)</span>
                    </h3>
                  </div>

                  <div class="tenant-cards">
                    <div 
                      *ngFor="let member of getGroupMembers(tenant.tenantGroup)" 
                      class="tenant-card"
                      [class.primary-tenant]="member.isPrimary">
                      
                      <div class="tenant-card-header">
                        <div class="tenant-info">
                          <div class="tenant-avatar">
                            <mat-icon [style.color]="member.isPrimary ? '#ffc107' : '#2196f3'">
                              {{ member.isPrimary ? 'star' : 'person' }}
                            </mat-icon>
                          </div>
                          <div class="tenant-details">
                            <h4>
                              {{ member.name }}
                              <span *ngIf="member.isPrimary" class="primary-badge">Primary</span>
                            </h4>
                            <p>{{ member.email }}</p>
                            <p>{{ member.phoneNumber }}</p>
                            <p>{{ member.occupation }}</p>
                          </div>
                        </div>
                        
                        <div class="tenant-status">
                          <span class="status-chip" [ngClass]="getStatusClass(member)">
                            <mat-icon style="font-size: 14px;">{{ getStatusIcon(member) }}</mat-icon>
                            {{ getStatusText(member) }}
                          </span>
                        </div>
                      </div>

                      <div class="tenant-card-actions">
                        <mat-icon
                          matTooltip="View Details"
                          style="color: #2196f3; cursor: pointer;"
                          (click)="onViewTenant(member)">
                          visibility
                        </mat-icon>
                        
                        <mat-icon
                          matTooltip="Edit Tenant"
                          style="color: #ff9800; cursor: pointer;"
                          (click)="onEditTenant(member)">
                          edit
                        </mat-icon>
                        
                        <mat-icon
                          matTooltip="Create Agreement"
                          style="color: #9c27b0; cursor: pointer;"
                          (click)="onCreateAgreement(member)">
                          description
                        </mat-icon>
                        
                        <mat-icon
                          matTooltip="Send Onboarding Email"
                          style="color: #4caf50; cursor: pointer;"
                          *ngIf="member.needsOnboarding"
                          (click)="onSendOnboardingEmail(member)">
                          email
                        </mat-icon>
                        
                        <mat-icon
                          matTooltip="Delete Tenant"
                          style="color: #f44336; cursor: pointer;"
                          (click)="onDeleteTenant(member)">
                          delete
                        </mat-icon>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </td>
          </ng-container>

          <!-- Header Row -->
          <tr mat-header-row *matHeaderRowDef="displayedColumnsWithExpand"></tr>
          
          <!-- Data Rows -->
          <tr mat-row *matRowDef="let tenant; columns: displayedColumnsWithExpand;"
              class="tenant-element-row"
              [class.tenant-expanded-row]="isExpanded(tenant)"
              (click)="toggleExpansion(tenant)">
          </tr>
          
          <!-- Expanded Detail Rows -->
          <tr mat-row *matRowDef="let row; columns: ['expandedDetail']" class="tenant-detail-row"></tr>
        </table>
      </div>
    </div>
  </div>

  <!-- Add Tenant Form -->
  <div *ngIf="currentView === 'add'" class="form-view">
    <app-tenant-add [propertyOptions]="propertyOptions"
      (tenantAdded)="onTenantAdded()"
      (cancel)="onTenantAddCancelled()" />
  </div>
</div>