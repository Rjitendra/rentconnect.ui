<div class="tenant-dashboard">
  <!-- Page Header -->
  <div class="dashboard-header">
    <div class="header-content">
      <h1>Tenant Management</h1>
      <p>Manage your tenants, agreements, and onboarding process</p>
    </div>
    @if (currentView === "table") {
      <div class="header-actions">
        <ng-button
          buttonType="button"
          type="filled"
          label="Add New Tenant"
          icon="add"
          cssClass="create-btn"
          (buttonClick)="onAddTenant()"
        />
      </div>
    }
  </div>

  <!-- Table View -->
  @if (currentView === "table") {
    <div class="table-view">
      <!-- Statistics Cards -->
      <div class="stats-cards">
        <div class="stat-card">
          <ng-icon name="people" class="stat-icon" />
          <div class="stat-content">
            <span class="stat-number">{{ tenants.length }}</span>
            <span class="stat-label">Total Tenants</span>
          </div>
        </div>
        <div class="stat-card">
          <ng-icon name="check_circle" class="stat-icon active" />
          <div class="stat-content">
            <span class="stat-number">{{ getActiveTenants() }}</span>
            <span class="stat-label">Active Tenants</span>
          </div>
        </div>
        <div class="stat-card">
          <ng-icon name="pending" class="stat-icon pending" />
          <div class="stat-content">
            <span class="stat-number">{{ getPendingOnboarding() }}</span>
            <span class="stat-label">Pending Onboarding</span>
          </div>
        </div>
        <div class="stat-card">
          <ng-icon name="attach_money" class="stat-icon revenue" />
          <div class="stat-content">
            <span class="stat-number"
              >₹{{ getTotalRentAmount() | number: "1.0-0" }}</span
            >
            <span class="stat-label">Monthly Rent</span>
          </div>
        </div>
      </div>

      <!-- Tenant Table with NgMatTable -->
      <div class="table-section">
        @if (initDashBoard$ | async) {
          <ng-mat-table
            [columns]="tableColumns"
            [data]="primaryTenants"
            [options]="tableOptions"
            [expandableRows]="true"
            [expandedRowTemplate]="expandedRowTemplate"
            [expandKey]="'id'"
            [isPaginator]="true"
            (rowClick)="onRowClick($any($event))"
            (rowExpand)="onRowExpand($any($event))"
          />
        }

        <!-- Template for expanded row content -->
        <ng-template #expandedRowTemplate let-tenant>
          <div class="expanded-content">
            <!-- Property Information Section -->
            <div class="expanded-header">
              <div class="property-section">
                <div class="section-title">
                  <ng-icon name="home" class="section-icon" />
                  <h4>Property Information</h4>
                </div>
                <div class="property-details">
                  <div class="detail-item">
                    <span class="label">Property:</span>
                    <span class="value">{{
                      getPropertyName(tenant.propertyId)
                    }}</span>
                  </div>
                  <div class="detail-item">
                    <span class="label">Rent Amount:</span>
                    <span class="value highlight"
                      >₹{{ tenant.rentAmount | number }}</span
                    >
                  </div>
                  <div class="detail-item">
                    <span class="label">Security Deposit:</span>
                    <span class="value"
                      >₹{{ tenant.securityDeposit | number }}</span
                    >
                  </div>
                  <div class="detail-item">
                    <span class="label">Lease Duration:</span>
                    <span class="value"
                      >{{ tenant.leaseDuration || "N/A" }} months</span
                    >
                  </div>
                </div>
              </div>
            </div>

            <!-- Tenant Group Members Section -->
            <div class="tenant-group-section">
              <div class="section-title">
                <ng-icon name="people" class="section-icon" />
                <h4>
                  Tenant Group Members ({{
                    getGroupMemberCount(tenant.tenantGroup)
                  }})
                </h4>
              </div>

              <div class="tenant-members-grid">
                @for (
                  member of getGroupMembers(tenant.tenantGroup);
                  track member.id
                ) {
                  <div
                    class="member-card"
                    [class.primary-member]="member.isPrimary"
                  >
                    <div class="member-header">
                      <div class="member-avatar">
                        <ng-icon
                          [name]="member.isPrimary ? 'star' : 'person'"
                          [class]="
                            member.isPrimary ? 'icon-primary' : 'icon-secondary'
                          "
                        />
                      </div>
                      <div class="member-info">
                        <div class="member-name">
                          <span>{{ member.name }}</span>
                          @if (member.isPrimary) {
                            <span class="primary-badge">Primary</span>
                          }
                        </div>
                        <div class="member-status">
                          <ng-icon
                            class="status-icon"
                            [name]="getStatusIcon(member)"
                          />
                          <span [class]="getStatusClass(member)">{{
                            getStatusText(member)
                          }}</span>
                        </div>
                      </div>
                    </div>

                    <div class="member-details">
                      <div class="contact-info">
                        <div class="contact-item">
                          <ng-icon name="email" class="contact-icon" />
                          <span>{{ member.email || "N/A" }}</span>
                        </div>
                        <div class="contact-item">
                          <ng-icon name="phone" class="contact-icon" />
                          <span>{{ member.phoneNumber || "N/A" }}</span>
                        </div>
                        <div class="contact-item">
                          <ng-icon name="work" class="contact-icon" />
                          <span>{{ member.occupation || "N/A" }}</span>
                        </div>
                      </div>

                      <!-- Member Actions -->
                      <div class="member-actions">
                        @if (!member.agreementSigned) {
                          <ng-button
                            buttonType="button"
                            type="outlined"
                            size="small"
                            icon="description"
                            tooltip="Create Agreement"
                            (buttonClick)="onCreateAgreement(member)"
                          >
                            Agreement
                          </ng-button>
                        }
                        @if (member.needsOnboarding) {
                          <ng-button
                            buttonType="button"
                            type="filled"
                            size="small"
                            icon="send"
                            tooltip="Send Onboarding Email"
                            (buttonClick)="onSendOnboardingEmail(member)"
                          >
                            Onboard
                          </ng-button>
                        }
                        <ng-button
                          buttonType="button"
                          type="icon"
                          size="small"
                          icon="visibility"
                          tooltip="View Details"
                          (buttonClick)="onViewTenant(member)"
                        />
                        <ng-button
                          buttonType="button"
                          type="icon"
                          size="small"
                          icon="edit"
                          tooltip="Edit Tenant"
                          (buttonClick)="onEditTenant(member)"
                        />
                        <ng-button
                          buttonType="button"
                          type="icon"
                          size="small"
                          icon="delete"
                          tooltip="Delete Tenant"
                          (buttonClick)="onDeleteTenant(member)"
                        />
                      </div>
                    </div>
                  </div>
                }
              </div>
            </div>
          </div>
        </ng-template>
      </div>
    </div>
  }

  <!-- Add Tenant Form -->
  @if (currentView === "add") {
    <div class="form-view">
      <app-tenant-add
        (tenantAdded)="onTenantAdded()"
        (cancelled)="onTenantAddCancelled()"
      />
    </div>
  }
</div>
