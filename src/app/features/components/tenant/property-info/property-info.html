<div class="property-info">
  <div class="header-section">
    <div class="header-content">
      <ng-icon
        name="arrow_back"
        matTooltip="Go back to tenant portal"
        class="arrow_back"
        (click)="goBack()"
      />
      <div class="header-text">
        <h1>Property Information</h1>
        <p>View your rental property details and documentation</p>
      </div>
    </div>
  </div>

  @if (loading) {
    <div class="loading-container">
      <div class="loading-spinner"></div>
      <p>Loading property information...</p>
    </div>
  }

  @if (!loading && property && tenant) {
    <!-- Property Details -->
    <ng-card class="property-details-card">
      <div class="card-header">
        <i class="material-icons">home</i>
        <h2>Property Details</h2>
      </div>

      <div class="property-grid">
        <div class="detail-item">
          <ng-label
            [label]="'Property Name'"
            [toolTip]="'Name of the property'"
          />
          <span>{{ property.title || "N/A" }}</span>
        </div>
        <div class="detail-item">
          <ng-label
            [label]="'Property Type'"
            [toolTip]="'Type of property (apartment, house, etc.)'"
          />
          <span>{{ property.propertyType || "N/A" }}</span>
        </div>
        <div class="detail-item">
          <ng-label [label]="'Address'" [toolTip]="'Full property address'" />
          <span>{{ getFullAddress() }}</span>
        </div>
        <div class="detail-item">
          <ng-label
            [label]="'City'"
            [toolTip]="'City where property is located'"
          />
          <span>{{ property.city || "N/A" }}</span>
        </div>
        <div class="detail-item">
          <ng-label
            [label]="'State'"
            [toolTip]="'State where property is located'"
          />
          <span>{{ property.state || "N/A" }}</span>
        </div>
        <div class="detail-item">
          <ng-label
            [label]="'PIN Code'"
            [toolTip]="'Postal code of the property'"
          />
          <span>{{ property["pincode"] || "N/A" }}</span>
        </div>
        <div class="detail-item">
          <ng-label [label]="'Bedrooms'" [toolTip]="'Number of bedrooms'" />
          <span>{{ property["bedrooms"] || "N/A" }}</span>
        </div>
        <div class="detail-item">
          <ng-label [label]="'Bathrooms'" [toolTip]="'Number of bathrooms'" />
          <span>{{ property["bathrooms"] || "N/A" }}</span>
        </div>
        <div class="detail-item">
          <ng-label
            [label]="'Area (sq ft)'"
            [toolTip]="'Property area in square feet'"
          />
          <span>{{ (property["area"] | number) || "N/A" }}</span>
        </div>
      </div>
    </ng-card>

    <!-- Rental Information -->
    <ng-card class="rental-info-card">
      <div class="card-header">
        <i class="material-icons">receipt_long</i>
        <h2>Rental Information</h2>
      </div>

      <div class="rental-grid">
        <div class="detail-item">
          <ng-label
            [label]="'Monthly Rent'"
            [toolTip]="'Monthly rental amount'"
          />
          <span class="amount">â‚¹{{ (tenant.rentAmount | number) || 0 }}</span>
        </div>
        <div class="detail-item">
          <ng-label
            [label]="'Security Deposit'"
            [toolTip]="'Security deposit amount'"
          />
          <span class="amount"
            >â‚¹{{ (tenant.securityDeposit | number) || 0 }}</span
          >
        </div>
        <div class="detail-item">
          <ng-label
            [label]="'Maintenance Charges'"
            [toolTip]="'Monthly maintenance charges'"
          />
          <span class="amount"
            >â‚¹{{ (tenant.maintenanceCharges | number) || 0 }}</span
          >
        </div>
        <div class="detail-item">
          <ng-label
            [label]="'Tenancy Start Date'"
            [toolTip]="'Date when tenancy begins'"
          />
          <span>{{
            (tenant.tenancyStartDate | date: "MMM dd, yyyy") || "N/A"
          }}</span>
        </div>
        <div class="detail-item">
          <ng-label
            [label]="'Tenancy End Date'"
            [toolTip]="'Date when tenancy ends'"
          />
          <span>{{
            (tenant.tenancyEndDate | date: "MMM dd, yyyy") || "N/A"
          }}</span>
        </div>
        <div class="detail-item">
          <ng-label
            [label]="'Rent Due Date'"
            [toolTip]="'Day of month when rent is due'"
          />
          <span
            >{{ (tenant.rentDueDate | date: "dd") || "N/A" }} of every
            month</span
          >
        </div>
      </div>
    </ng-card>

    <!-- Property Images -->
    <ng-card class="property-images-card">
      <div class="card-header">
        <i class="material-icons">photo_library</i>
        <h2>Property Images</h2>
      </div>

      <!-- Landlord Images -->
      @if (landlordImages.length > 0) {
        <div class="images-section">
          <h3>
            <i class="material-icons">business</i>
            Property Photos by Landlord
          </h3>
          <div class="images-grid">
            @for (image of landlordImages; track image.url) {
              <div class="image-item">
                <img
                  [src]="image.url"
                  [alt]="image.name"
                  (click)="openImageModal(image)"
                />
                <div class="image-info">
                  <span class="image-name">{{ image.name }}</span>
                  <span class="image-date">{{
                    image.uploadedOn | date: "MMM dd, yyyy"
                  }}</span>
                </div>
              </div>
            }
          </div>
        </div>
      }

      <!-- Tenant Images -->
      <div class="images-section">
        <div class="section-header">
          <h3>
            <i class="material-icons">person</i>
            Your Property Photos
          </h3>
          <ng-button
            variant="primary"
            size="small"
            (click)="showUploadModal = true"
          >
            <i class="material-icons">add_photo_alternate</i>
            Upload Photos
          </ng-button>
        </div>

        @if (tenantImages.length > 0) {
          <div class="images-grid">
            @for (image of tenantImages; track image.url) {
              <div class="image-item">
                <img
                  [src]="image.url"
                  [alt]="image.name"
                  (click)="openImageModal(image)"
                />
                <div class="image-info">
                  <span class="image-name">{{ image.name }}</span>
                  <span class="image-date">{{
                    image.uploadedOn | date: "MMM dd, yyyy"
                  }}</span>
                </div>
                <ng-button
                  [type]="'icon'"
                  [icon]="'delete'"
                  [buttonType]="'button'"
                  [tooltip]="'Delete image'"
                  [cssClass]="'delete-btn'"
                  (buttonClick)="deleteImage(image)"
                />
              </div>
            }
          </div>
        } @else {
          <div class="empty-state">
            <i class="material-icons">photo_camera</i>
            <p>No photos uploaded yet</p>
            <p class="sub-text">
              Upload photos to document the property condition
            </p>
          </div>
        }
      </div>
    </ng-card>

    <!-- Amenities -->
    @if (property["amenities"] && property["amenities"].length > 0) {
      <ng-card class="amenities-card">
        <div class="card-header">
          <i class="material-icons">apartment</i>
          <h2>Amenities</h2>
        </div>

        <div class="amenities-grid">
          @for (amenity of property["amenities"]; track amenity) {
            <div class="amenity-item">
              <i class="material-icons">check_circle</i>
              <span>{{ amenity }}</span>
            </div>
          }
        </div>
      </ng-card>
    }
  }

  <!-- Upload Modal -->
  @if (showUploadModal) {
    <div class="modal-overlay" (click)="closeUploadModal()">
      <div class="modal-container" (click)="$event.stopPropagation()">
        <div class="modal-header">
          <h3>Upload Property Photos</h3>
          <ng-button
            [type]="'icon'"
            [icon]="'close'"
            [buttonType]="'button'"
            [cssClass]="'close-btn'"
            (buttonClick)="closeUploadModal()"
          />
        </div>

        <div class="modal-body">
          <ng-file-upload
            [config]="fileUploadConfig"
            (filesSelected)="onFilesSelected($event)"
            (fileRemoved)="onFileRemoved($event)"
          />
        </div>

        <div class="modal-footer">
          <ng-button variant="secondary" (click)="closeUploadModal()">
            Cancel
          </ng-button>
          <ng-button
            variant="primary"
            [disabled]="selectedFiles.length === 0 || uploading"
            (click)="uploadFiles()"
          >
            {{ uploading ? "Saving..." : "Save" }}
          </ng-button>
        </div>
      </div>
    </div>
  }

  <!-- Image Modal -->
  @if (selectedImage) {
    <div class="image-modal-overlay" (click)="closeImageModal()">
      <div class="image-modal-container" (click)="$event.stopPropagation()">
        <ng-button
          [type]="'icon'"
          [icon]="'close'"
          [buttonType]="'button'"
          [cssClass]="'close-btn'"
          (buttonClick)="closeImageModal()"
        />
        <img [src]="selectedImage.url" [alt]="selectedImage.name" />
        <div class="image-modal-info">
          <h4>{{ selectedImage.name }}</h4>
          <p>
            Uploaded by {{ selectedImage.uploadedBy }} on
            {{ selectedImage.uploadedOn | date: "MMM dd, yyyy" }}
          </p>
          @if (selectedImage.description) {
            <p class="description">{{ selectedImage.description }}</p>
          }
        </div>
      </div>
    </div>
  }
</div>
