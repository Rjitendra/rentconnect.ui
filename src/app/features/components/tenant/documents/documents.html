<div class="documents">
  <div class="header-section">
    <div class="header-content">
      <ng-icon
        name="arrow_back"
        matTooltip="Go back to tenant portal"
        class="arrow_back"
        (click)="goBack()"
      />
      <div class="header-text">
        <h1>Documents & Agreement</h1>
        <p>Manage your rental documents and tenancy agreement</p>
      </div>
    </div>
  </div>

  @if (loading) {
    <div class="loading-container">
      <div class="loading-spinner"></div>
      <p>Loading documents...</p>
    </div>
  }

  @if (!loading) {
    <!-- Tenancy Agreement Section -->
    <ng-card
      title="Tenancy Agreement"
      icon="description"
      class="agreement-card"
    >
      @if (tenant?.agreementUrl) {
        <div class="agreement-section">
          <div class="agreement-info">
            <div class="agreement-details">
              <h3>Your Rental Agreement</h3>
              <div class="agreement-meta">
                <div class="meta-item">
                  <ng-label
                    [label]="'Agreement Date:'"
                    [toolTip]="'Date when the agreement was created'"
                  />
                  <span>{{
                    (tenant?.agreementDate | date: "MMM dd, yyyy") || "N/A"
                  }}</span>
                </div>
                <div class="meta-item">
                  <ng-label
                    [label]="'Status:'"
                    [toolTip]="'Current agreement status'"
                  />
                  <span
                    class="status"
                    [class.accepted]="tenant?.agreementAccepted"
                  >
                    {{ tenant?.agreementAccepted ? "Accepted" : "Pending" }}
                  </span>
                </div>
                @if (tenant?.agreementAccepted) {
                  <div class="meta-item">
                    <ng-label
                      [label]="'Accepted On:'"
                      [toolTip]="'Date when the agreement was accepted'"
                    />
                    <span>{{
                      (tenant?.agreementAcceptedDate | date: "MMM dd, yyyy") ||
                        "N/A"
                    }}</span>
                  </div>
                  <div class="meta-item">
                    <ng-label
                      [label]="'Accepted By:'"
                      [toolTip]="'Person who accepted the agreement'"
                    />
                    <span>{{ tenant?.agreementAcceptedBy || "N/A" }}</span>
                  </div>
                }
              </div>
            </div>
          </div>
        </div>
      } @else {
        <div class="empty-state">
          <i class="material-icons">description</i>
          <p>Agreement not yet available</p>
          <p class="sub-text">
            Your landlord will provide the agreement document once ready
          </p>
        </div>
      }
    </ng-card>

    <!-- Document Upload Section -->
    <ng-card title="Upload Documents" icon="cloud_upload" class="upload-card">
      <div class="upload-section">
        <div class="upload-info">
          <p>Select a category and upload your documents:</p>

          <!-- Category Selection -->
          <div class="category-selection">
            <ng-select
              class="full-width"
              label="Document Category"
              placeholder="Select document type"
              [options]="documentCategories"
              [(ngModel)]="selectedCategory"
              (ngModelChange)="onCategoryChange($event)"
            />
          </div>

          @if (!selectedCategory) {
            <div class="category-hint">
              <p><strong>Available categories:</strong></p>
              <ul>
                <li>Aadhaar Card - Government ID proof</li>
                <li>PAN Card - Tax identification document</li>
                <li>Address Proof - Utility bills, license</li>
                <li>Employment Proof - Salary slips, offer letter</li>
                <li>Bank Statement - Recent bank statements</li>
                <li>Profile Photo - Your photograph</li>
                <li>ID Proof - Any government ID</li>
                <li>Other Documents - Miscellaneous documents</li>
              </ul>
            </div>
          }
        </div>

        @if (selectedCategory) {
          <div class="upload-area">
            <div class="selected-category-info">
              <ng-icon name="folder" class="category-icon" />
              <span
                >Uploading to:
                <strong>{{ getCategoryLabel(selectedCategory) }}</strong></span
              >
            </div>

            <ng-file-upload
              [config]="fileUploadConfig"
              (filesSelected)="onFilesSelected($event)"
              (fileRemoved)="onFileRemoved($event)"
            />

            @if (selectedFiles.length > 0) {
              <div class="upload-actions">
                <ng-button
                  [type]="'filled'"
                  [label]="uploading ? 'Uploading...' : 'Upload Documents'"
                  [disabled]="uploading"
                  (buttonClick)="uploadDocuments()"
                />
              </div>
            }
          </div>
        }
      </div>
    </ng-card>

    <!-- Uploaded Documents Section -->
    <ng-card title="All Documents" icon="folder" class="documents-list-card">
      @if (documents.length > 0) {
        <!-- Documents Uploaded by Landlord -->
        @if (landlordDocuments.length > 0) {
          <div class="documents-section">
            <h3 class="section-title">
              <ng-icon name="business" class="section-icon" />
              Uploaded by Landlord
            </h3>
            <div class="documents-list">
              @for (document of landlordDocuments; track document.id) {
                <div class="document-item landlord-doc">
                  <div class="document-icon">
                    <i class="material-icons">{{
                      getDocumentIcon(document.type || "")
                    }}</i>
                  </div>

                  <div class="document-info">
                    <h4>{{ document.name }}</h4>
                    <div class="document-meta">
                      <span class="category">{{
                        getCategoryLabel(document.category)
                      }}</span>
                      <span class="size">{{
                        formatFileSize(document.size || 0)
                      }}</span>
                      <span class="date">{{
                        document.uploadedOn | date: "MMM dd, yyyy"
                      }}</span>
                      <span class="uploaded-by"
                        >By: {{ document.uploadedByName }}</span
                      >
                    </div>
                    @if (document.description) {
                      <p class="description">{{ document.description }}</p>
                    }
                  </div>

                  <div class="document-status">
                    @if (document.isVerified) {
                      <div class="status-badge verified">
                        <i class="material-icons">verified</i>
                        Verified
                      </div>
                    } @else {
                      <div class="status-badge pending">
                        <i class="material-icons">hourglass_empty</i>
                        Pending
                      </div>
                    }
                  </div>

                  <div class="document-actions">
                    <button
                      type="button"
                      class="action-icon-btn"
                      title="View document"
                      (click)="viewDocument(document)"
                    >
                      <i class="material-icons">visibility</i>
                    </button>
                    <button
                      type="button"
                      class="action-icon-btn"
                      title="Download document"
                      (click)="downloadDocument(document)"
                    >
                      <i class="material-icons">download</i>
                    </button>
                  </div>
                </div>
              }
            </div>
          </div>
        }

        <!-- Documents Uploaded by Current Tenant -->
        @if (currentTenantDocuments.length > 0) {
          <div class="documents-section">
            <h3 class="section-title">
              <ng-icon name="person" class="section-icon" />
              Uploaded by You
            </h3>
            <div class="documents-list">
              @for (document of currentTenantDocuments; track document.id) {
                <div class="document-item current-tenant-doc">
                  <div class="document-icon">
                    <i class="material-icons">{{
                      getDocumentIcon(document.type || "")
                    }}</i>
                  </div>

                  <div class="document-info">
                    <h4>{{ document.name }}</h4>
                    <div class="document-meta">
                      <span class="category">{{
                        getCategoryLabel(document.category)
                      }}</span>
                      <span class="size">{{
                        formatFileSize(document.size || 0)
                      }}</span>
                      <span class="date">{{
                        document.uploadedOn | date: "MMM dd, yyyy"
                      }}</span>
                    </div>
                    @if (document.description) {
                      <p class="description">{{ document.description }}</p>
                    }
                  </div>

                  <div class="document-status">
                    @if (document.isVerified) {
                      <div class="status-badge verified">
                        <i class="material-icons">verified</i>
                        Verified
                      </div>
                    } @else {
                      <div class="status-badge pending">
                        <i class="material-icons">hourglass_empty</i>
                        Pending
                      </div>
                    }
                  </div>

                  <div class="document-actions">
                    <button
                      type="button"
                      class="action-icon-btn"
                      title="View document"
                      (click)="viewDocument(document)"
                    >
                      <i class="material-icons">visibility</i>
                    </button>
                    <button
                      type="button"
                      class="action-icon-btn"
                      title="Download document"
                      (click)="downloadDocument(document)"
                    >
                      <i class="material-icons">download</i>
                    </button>
                    <button
                      type="button"
                      class="action-icon-btn delete-btn"
                      title="Delete document"
                      (click)="deleteDocument(document)"
                    >
                      <i class="material-icons">delete</i>
                    </button>
                  </div>
                </div>
              }
            </div>
          </div>
        }

        <!-- Documents Uploaded by Other Tenants -->
        @if (otherTenantDocuments.length > 0) {
          <div class="documents-section">
            <h3 class="section-title">
              <ng-icon name="group" class="section-icon" />
              Uploaded by Co-tenants
            </h3>
            <div class="documents-list">
              @for (document of otherTenantDocuments; track document.id) {
                <div class="document-item other-tenant-doc">
                  <div class="document-icon">
                    <i class="material-icons">{{
                      getDocumentIcon(document.type || "")
                    }}</i>
                  </div>

                  <div class="document-info">
                    <h4>{{ document.name }}</h4>
                    <div class="document-meta">
                      <span class="category">{{
                        getCategoryLabel(document.category)
                      }}</span>
                      <span class="size">{{
                        formatFileSize(document.size || 0)
                      }}</span>
                      <span class="date">{{
                        document.uploadedOn | date: "MMM dd, yyyy"
                      }}</span>
                      <span class="uploaded-by"
                        >By: {{ document.uploadedByName }}</span
                      >
                    </div>
                    @if (document.description) {
                      <p class="description">{{ document.description }}</p>
                    }
                  </div>

                  <div class="document-status">
                    @if (document.isVerified) {
                      <div class="status-badge verified">
                        <i class="material-icons">verified</i>
                        Verified
                      </div>
                    } @else {
                      <div class="status-badge pending">
                        <i class="material-icons">hourglass_empty</i>
                        Pending
                      </div>
                    }
                  </div>

                  <div class="document-actions">
                    <button
                      type="button"
                      class="action-icon-btn"
                      title="View document"
                      (click)="viewDocument(document)"
                    >
                      <i class="material-icons">visibility</i>
                    </button>
                    <button
                      type="button"
                      class="action-icon-btn"
                      title="Download document"
                      (click)="downloadDocument(document)"
                    >
                      <i class="material-icons">download</i>
                    </button>
                  </div>
                </div>
              }
            </div>
          </div>
        }
      } @else {
        <div class="empty-state">
          <i class="material-icons">folder_open</i>
          <p>No documents uploaded yet</p>
          <p class="sub-text">
            Upload your documents to keep them organized and accessible
          </p>
        </div>
      }
    </ng-card>
  }
</div>
